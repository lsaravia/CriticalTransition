
#  Biodiversity collapse and early warning indicators in a spatial phase transition between neutral and niche communities

**Leonardo A. Saravia** ^1^ ^2^, **Fernando R. Momo** ^1^ 

1. Instituto de Ciencias 

	Universidad Nacional de General Sarmiento

	J.M. Gutierrez 1159 (1613), Los Polvorines

	Buenos Aires, Argentina.

2. E-mail: <lsaravia@ungs.edu.ar>,  Orcid id 0000-0002-7911-4398

\newpage

## Abstract

The dynamics of ecological communities have been described by neutral and niche theories that are now increasingly integrated into unified models. It is known that a critical transition exists between these two states, but the spatial aspect of this transition has not been studied. Our aim is to study the spatial aspect of the transition and propose early warning signals to detect it. We used a stochastic, spatially explicit model that spans a continuum from neutral to niche communities, and is driven by the intensity of hierarchical competition. The transition is indicated by the emergence of a large patch formed by one species that connects the whole area. The properties of this patch can be used as early warning indicators of a critical transition. If competition intensity increases beyond the critical point, our model shows a sudden decrease of the Shannon diversity index and a gentle decline in species richness. The critical point occurs at a very low value of competitive intensity, with the rate of migration from the metacommunity greatly influencing the position of this critical point. As an example, we apply our new method of early warning indicators to the Barro Colorado Tropical forest, which, as expected, appears to be far from a critical transition. Low values of competitive intensity were also reported by previous studies for different high-diversity real communities, suggesting that these communities are located before the critical point. A small increase of competitive interactions could push them across the transition, however, to a state in which diversity is much lower. Thus this new early warnings indicator could be used to monitor high diversity ecosystems that are still undisturbed. 

*Short title:* A spatial phase transition between neutral and niche communities

*keywords:* Continuous critical transitions; Percolation; Neutral-niche communities; spatial stochastic models; Biodiversity collapse 



\newpage

## Introduction

Much effort has been devoted to understanding the mechanisms of community assembly and dynamics. Classical studies emphasized deterministic processes based on niche differences between species; niche theory assumes that different species are regulated by various environmental factors and infer that diversity originates from spatial and temporal environmental heterogeneity [@Tilman1982; @Chesson2000]. More recently, the emphasis has shifted to stochastic mechanisms in the form of the Neutral Theory of Biodiversity and Biogeography [@Hubbell2001]. The neutral theory assumes that individuals of all species are functionally equivalent, and proposes that diversity originates from a balance between immigration, speciation, and extinction. The neutral theory has been proposed as a parsimonious formulation that can provide new insight into the patterns of community assembly [@Hubbell2005]. In spite of its simplicity, the theory can predict some community metrics very well, like the species abundance distribution (SAD) [@Volkov2007; @Rosindell2012], beta-diversity [@Condit2002] and species-area relationships [@Rosindell2009; @ODwyer2010].

The neutral theory has generated a great deal of controversy, mainly due to its equivalence assumption [@Clark2012a;@Chave2004]. One way to resolve this is to understand that at a local scale, niche differences between species seem to be important for community dynamics, but at broader scales differences in specific traits are not essential to predict community patterns [@Chave2004; @Matthews2014]. Finally, a unified view has arisen that accepts that both kinds of mechanisms are present at the same time, shifting the focus to quantifying the relative importance of these in natural communities [@Kalyuzhny2014;@Martorell2014; @Vergnon2009; @Jabot2011; @Gravel2006; @Zhou2008].  

The problems of pattern and scale are critical in ecology [@Levin1992; @Chave2013], because patterns that seem stochastic at one scale may reveal structure at another scale. The concept of pattern is related to some sort of repetition that our brain can detect; when this pattern occurs at different scales we talk about scale invariance or self-similarity, characterized by power laws. These patterns could be produced by critical phase transitions described by percolation theory [@Stauffer1994]. These kinds of spatial phase transitions were first introduced in ecology in the framework of landscape ecology [@Loehle1996b] and habitat fragmentation [@Bascompte1996]. 

Percolation is characterized by the presence of two phases defined by some macroscopic features, such as the presence or absence of vegetation in arid ecosystems [@Kefi2007b]. These phases are linked by a critical point were a sudden transition happens and a large spatial pattern emerges. To illustrate the mechanism behind a phase transition, we define first a two-dimensional landscape composed by a grid of sites. Each site is connected to its four nearest neighbors with probability $p$. If $p$ is small there will be only a few connected sites that form clusters. When $p$ increases, the clusters become larger because each site is connected with higher probability to its neighbors. Finally, there is one value of $p$ at which a single cluster spans the entire landscape. This spanning cluster has a self-similar structure and is produced by local interactions [@Sole2006]. The clusters are usually called 'patches' in the ecological literature, and here we continue to use patches to refer to the clusters that connect through their four nearest neighbors. 

Several different ecological spatial models exhibit critical behavior related to the degree of disturbance [@Pascual2005a]. Some of these models show robust criticality, a particular kind of criticality for ecological systems, in which self-similarity is present for a wide range of parameters and does not necessarily involve drastic changes in the biological variables of interest [@Roy2003]. This kind of criticality has been suggested for arid ecosystems [@Sole2007], in which a sudden shift towards desert conditions might occur when rainfall decreases [@Scanlon2007] or also with more intense grazing [@Kefi2007b]. The mechanism producing self-similarity is the positive effect produced by local facilitation, e.g. the establishment of a new seedling is more likely near the parent plant. Another example of an ecosystem exhibiting criticality are savannas, where the transition occurs between tree and grass cover [@Abades2014]. In critical phenomena, the transition is produced by the capacity of the system to transmit some signal or information. In savannas, when the proportion of grass approaches a 60%, fire can spread across the landscape; conversely, if there is less grass to act as a fuel, fire cannot spread [@Staver2012]. Thus an increase in the proportion of trees, due to a change in environmental conditions, can create positive feedback mechanisms resulting in the encroachment of savanna ecosystems [@Abades2014].  

The self-similar structure of the spanning patch is characterized by a power law patch size distribution, but neutral models can produce power law patch distributions without being near a critical state [@Houchmandzadeh2003], so the detection of these kind of patterns does not imply a phase transition. Moreover, sudden changes between neutral and niche dynamics have been described for non-spatial models [@Chisholm2011; @Zhou2008; @Kalyuzhny2014], and Fisher et al. [-@Fisher2014] demonstrated the presence of a phase transition for neutral-niche models. However, the spatial properties and consequences of this transition have not been studied.

Here we study the phase transition between neutral and niche dynamics from a spatial point of view by applying methods of percolation theory. We will use a spatially explicit neutral model where niche dynamics is represented as a competitive hierarchy [@Saravia2015a]. Our first objective is to demonstrate the existence of the phase transition in our spatial neutral-niche model triggered by competition intensity; we show that the phase transition is determined by the geometric characteristics of the species patches, and that the niche state that emerges after the critical point has lower species diversity and richness. Our second objective is to define early warning indicators based on the dynamics of patches. Finally, we apply our new early warning indicators to the repeated censuses of a 50-ha forest dynamics plot of Barro Colorado Island (BCI) in Panama.


# Methods

First, we define the spatial explicit neutral-hierarchical model; then we explain how we characterized its critical behavior in terms of percolation theory and how simulations were performed. We analyze early warnings for this critical transition and apply the same techniques for BCI plot data. We refer interested readers to more extensive introductions to percolation theory in an ecological context [@Sole2006; @Oborny2007].

## The spatial stochastic model

This model represents a continuum between a neutral model and a niche model of hierarchical competition, in the same spirit as @Gravel2006, and others [@Chisholm2010;@Zhou2008]. The model is a stochastic cellular automaton (CA), also called an interactive particle system [@Durrett1994a]. In these models space is discretized into a grid and only one individual can occupy a particular position. Each position represents an area fixed by the investigator to mimic the real system. Time is continuous, so the update of the model is asynchronous. Sites are selected at random and to perform one complete time interval $J$ sites have to be updated, where $J$ is the size of the grid [@Durrett1994a]. The units of the grid are arbitrary but for using parameters compatible with field studies we choose a side of 1 meter.  

We use periodic boundary conditions, which makes the landscape a torus: sites on the top edge of the grid are neighbors of those on the bottom edge, and sites on the right edge are neighbors of those on the left. With this choice we avoid edge effects, this is equivalent to treating the grid as embedded in a large community. The size of the community is given by *J = dimX* x *dimY*, where *dimX* and *dimY* are the dimensions of the grid. Thus *J* is the maximum number of individuals in the simulated area. As in a classical neutral model, there is a metacommunity, i.e. a regional species pool assumed to be very large and invariant in ecological time scales [@Hubbell2001]. All individuals have the same parameters, unless they belong to different species [@Hubbell2001], and each species is assigned an indicator number that is used to define a competitive hierarchy. There are only two possible differences between species: 

* They may have a different frequency $X_i$ in the metacommunity and also different abundances in the local community. 

* Hierarchical competition: species with lower numbers have a probability of replacing species with higher numbers as in [@Tilman1994]. Thus a species with number 1 has a probability of replacing species with number 2 and greater. The species with number 2 can replace species starting from 3. The probability of replacement ($\rho$) is a parameter; when it is 0, there is no replacement and the model behaves like a neutral model without competitive hierarchy.  The parameter $\rho$ is also referred as the intensity of competition, because when $\rho=1$ the intensity will be maximal: whenever two individuals of different species meet there will be a competitive displacement. When $\rho$ is lower, this will not happen in all encounters, and the intensity of competition will decrease.  

The colonization-competition and other possible trade-offs are not explicitly included in the model. However, a colonization-competition trade-off can be established if species numbering is arranged in inverse order to its frequency $X_i$ in the metacommunity. If colonization-competition trade-off is included, the most competitive species (with number 1) will have the lowest migration rate and the less competitive will have the highest migration rate.  

There are four processes included in the model: death, local dispersal, migration, and competition. After setting initial conditions the following events can happen:

(A) If the selected site is empty:  
	
	(1) With probability *m* an individual of a species *i* can migrate from the metacommunity, at a rate proportional to its frequency $X_i$ in the metacommunity.

	(2) With probability *1-m* the site could be occupied by a new individual that disperses to the neighborhood with a dispersal kernel. Here we use an inverse power kernel with average distance $d$ [@Marco2011]:

 	$d(x) =  \frac{\alpha -1}{x_{min}} \left(\frac{x}{x_{min}} \right)^{-\alpha}$ with $mean =\frac{\alpha-1}{\alpha-2}x_{min}$ where $\alpha > 1$ and $x \ge x_{min}$. 

	where $d(x)$ is the probability that an individual disperses a distance $x$ from the parent. In all cases we used $x_{min} = 1$. 

(B) If the selected site is not empty: 

	(3) Individuals die at a rate $\mu$

	(4) When an individual dies, it is replaced by a migrant from metacommunity with probability $m$ and with probability $1-m$ by an individual from the neighborhood as in (1) and (2). Once the grid is full it stays full, because when an individual dies it is immediately replaced by another. This is called the zero-sum assumption in neutral models. 

	(5) Surviving individuals can be replaced by individuals from the metacommunity or neighborhood as in (4) based on the competitive hierarchy where an individual of species $k$ can only replace an individual of species $k + 1$ with probability $\rho$. Thus a hierarchical ordering of species is established. When this probability is zero, the model behavior becomes neutral.

In the simulations, the events are evaluated in the order specified by its numbers. The parameter $m$ has the same meaning as in the spatially implicit neutral model, but there are two fundamental differences: a) individuals that disperse by the edges of the lattice produce the same effect as $m$, and therefore as local dispersion already accounts for part of migration, the values of $m$ are lower for our spatially explicit model; b) individuals who colonize the grid due to $m$ do so in random positions, disrupting the patch structure produced by local dispersion.

The model was developed using the C++ programming language and its source code is available at <https://github/lasaravia/neutral> and figshare <http://dx.doi.org/10.6084/m9.figshare.969692>. 

## Percolation and simulations

To characterize our model in terms of percolation theory, we need to define an order parameter that depends on a tuning parameter (describing an external control) that can be continuously varied. We defined the tuning parameter as the replacement probability $\rho$, and the order parameter as the probability that a patch of one species connects the landscape, called the spanning cluster probability $SC_p$. Percolation is produced when a spanning cluster is present, meaning that there is at least one patch of one species that spans from one edge of the system to the opposite edge. We calculated the patches for all species using a modified Hoshen–Kopelman cluster labeling algorithm [@Hoshen1976] with a neighborhood defined by the four nearest sites (Von Neumann neighborhood) available at <https://github.com/lsaravia/Clusters>. A method to obtain the percolation point is to estimate the value of the tuning parameter $\rho$ at which $SC_p$ is 0.5 [@Ziff2002]. To obtain $SC_p$ we measure the frequency of simulations where a spanning cluster appears. We used one snapshot of the spatial pattern to make our results more compatible with field studies; hence we measure the patch size distributions after the model reach a steady state between 5000 and 30000 time intervals (as defined above). We checked that the model reached a steady state by a series of preliminary simulations using the same range of parameters as for the experiment. We calculated the average Shannon diversity index ($H$) of the last 1000 time steps for runs with different total time (3000,5000,10000,20000 and 30000 time steps). Then we compared the values of the average $H$ for consecutive total times (3000 vs 5000, 5000 vs 10000,) and we observed if the last $H$ range was similar to the previous. If the range keeps constant, we take the minimum time as the steady state simulation time. We also checked the steady state by visually inspecting the $H$ time series.

The size of the lattice affects the value of the critical point $\rho_c$ at which the transition occurs; in small lattices $SC_p$ is non-zero for values of $\rho$ below the critical point $\rho_c$, this means that patches that connect the entire lattice appear by chance. Therefore, to obtain an asymptotic estimate for $\rho_c$ we performed a finite size scaling analysis. For this, we run simulations for different lattice sizes (Side = 128, 192, 256) and obtained asymptotic values by regressing $\rho_c$ against $1/Side^2$; the intercept becomes an estimate for a lattice of infinite size, denoted by $\rho_c^\infty$ [@Stauffer1994; @Sornette2013]. 

We determined critical points for two different metacommunities: a) One with a logseries species abundance distribution, the most common distribution that fits experimental data [@White2012]. With this metacommunity we included a competition-colonization trade-off by arranging species numbers in inverse order as it is frequency $X_i$ in the metacommunity. b) A uniform species distribution, in which all species have the same probability of colonizing the local community. The parameter $m$ represents a long-distance dispersal event from the metacommunity but can also be interpreted as a speciation parameter [@Chave2004; @Rosindell2009]. The values of the $m$ parameter (Table 1) were at least two orders of magnitude higher than realistic speciation rates [@Rosindell2009] as it is not our aim to interpret the results in an evolutionary framework, only to show the influence of different metacommunities. 

The parameters used were compatible with published results from tropical forests, but we do not intend to encompass all the possibilities: the number of species in the metacommunity was between 16 and 320, and the mean dispersal distance was between 13-53 meters [@Anand2010; @Condit2002]. It has been suggested that fat-tail dispersal kernels give more realistic results [@Rosindell2009; @Seri2012] so we used an inverse power law distribution with exponents always greater than two (Table 1). The parameter $m$ has a range from 0.0001 to 0.01; note that the spatially explicit parameters do not have the same values than the parameters estimated for the spatially implicit model. We used the formulas from Etienne & Rosindell [-@Etienne2011] to calculate the equivalence of spatially explicit parameters with the neutral theory spatially implicit parameters $\theta$ and $I$ (Appendix Table S1). The range of the parameter $m$ is similar to the one used in other studies of neutral spatially explicit models [@May2015].

The parameter $\rho$ is varied across all the range between 0 and 1 to determine the critical point. In the region where we suspected the $\rho_c$ to be located (near 0), the steps were very small (0.0001), and greater (0.1) in regions unlikely to include $\rho_c$. To calculate the value of $\rho_c$ at which $SC_p=0.5$ we interpolate linearly from the four values of $\rho$ that have the nearest values of $SC_p$ to 0.5.

All simulations started with a lattice filled with individuals at random positions, following the same abundance distribution as the metacommunity. For each parameter combination we performed 50 simulations. Thus, we calculated the $SC_p$ as the number of times we observed a spanning cluster divided by the number of simulations. The analysis of the model output was done in the R statistical language [@RCoreTeam2015] and the scripts are available at GitHub <https://github.com/lsaravia/CriticalTransition> and figshare <http://dx.doi.org/10.6084/m9.figshare.2007537>.

We estimated the critical point using a wide range of parameters to test that the transition is not confined to a small region in the parameter space. In addition, we analyzed changes in the critical point to give us an idea of the sensitivity of the simulated communities to changes in the intensity of competition. This could be used to compare the predictions of the model with the behavior of real communities where a change in the competitive intensity has been documented. We analyzed the critical point for infinite lattices ($\rho_c^\infty$) varying three parameters of the model, one at a time: the migration $m$, the dispersal distance, and the number of species in the metacommunity. The parameter $\mu$ was fixed at 0.2, a higher mortality rate than observed for tropical forests, but because of the zero-sum assumption the only effect of this is to increase the turnover rate of species and thus reduce the time needed to reach a steady-state of the model. To change the dispersal distance we varied the power exponent of the dispersal kernel $\alpha$ (Table 1). We used as a baseline the parameters listed in the first row of table 1, so if we vary $m$, the other parameters are fixed at $\alpha=2.04$ and the metacommunity number of species to 320. 


-------------------------------------------------------
  Side   Metacomm.     $\mu$   $\alpha$        $m$
         No. Species           (mean dist.)       
------- ------------- ------- -------------- ----------  
   128           320     0.2   2.04 (26.6)    0.0001    

   192           64      	     2.08 (13.3)    0.001     

   256           16     	     2.02 (53.3)    0.01      

                                                
-------------------------------------------------------

Table: Parameters values used in the simulations of the neutral-hierarchical model. Side is the size of the side of the simulation grid. The parameter $\mu$ is the mortality rate; $\alpha$ is the exponent of the inverse power law dispersal kernel, between brackets is the mean dispersal distance; and $m$ is the migration from the metacommunity. The units of the simulation grid and dispersal are in meters to make them comparable with field values.


## Communities and early warnings signals

To compare community changes near and far from the critical point $\rho_c$ we calculated the species abundance distribution (SAD) and the rank abundance distribution (RAD). RADs are equivalent to cumulative distributions and thus are a robust way to visualize the SAD without losing information [@Etienne2011; @Newman2005]. We also calculated richness as the number of species ($S$), and the Shannon diversity index: $H=-\sum_{i=1}^{S}p_i ln(p_i)$, where $p_i$ is the relative abundance of each species.  

At the critical point there is a species with a large patch that dominates the landscape: the spanning species, the species with the largest patch ($S_{max}$). Before the critical point, the system is in a subcritical state, and the species with the largest patch could be the spanning species. After the critical point, the system is in a supercritical state and most of the landscape is occupied by the spanning species. The fraction of the cover of the largest patch ($S_{max}$) can be used as an index to determine if the system is in a subcritical or supercritical state. The $S_{max}$ is calculated as the size of the largest patch divided by the area of the system. If we are working with natural systems the total area might not be precisely calculated; i.e. if we included a non-habitable area we will overestimate the total area, and the Smax will be underestimated. Thus, we also divided the largest patch area by the total area occupied by the species, as this represents the proportion of the largest patch to the total area occupied by the same species $RS_{max}$. The $S_{max}$ and $RS_{max}$ are useful qualitative indices that can be used to detect if the system is in a subcritical or supercritical state, but do not tell us if the system is near or far from the critical transition. 

The closeness of the critical transition can be evaluated using the temporal fluctuations of $S_{max}$ [@Corrado2014]. We calculate the $S_{max}$ fluctuations around the mean $\Delta S_{max}=S_{max}(t)-\langle S_{max} \rangle$, and $\Delta RS_{max}$ using the same formula but with $RS_{max}$.  The variance of the fluctuations of the largest patch $\Delta S_{max}$ reaches a maximum at the critical point but a significant increase occurs well before the system reaches the critical point [@Corrado2014]. Also, before the critical point, when the skewness of the distribution of $\Delta S_{max}$ and $\Delta RS_{max}$ should be negative, because fluctuations below the average are more frequent [@Corrado2014]. We calculated the fluctuations using the last 50 points of the time series with the same length and a similar range of $\rho$ as the ones used for the estimation of the critical point. We classified them as before, near and after the critical point, and for each $\rho$ we performed ten repetitions. 

For spatial systems with patch structures another possible early warning indicator of the transition is the distribution of patch sizes or clusters [@Kefi2014]. From percolation theory we expect that the distribution of the species with the largest or spanning patch should be a power law ($f(x)=x^{-\alpha}$) or a power law with exponential cutoff ($f(x)=x^{-\alpha}e^{-\lambda x}$) [@Stauffer1994;@Weerman2012; @Pueyo2011]. Besides that, we already know that the patch size distributions of species in spatially explicit neutral models follow a power law corresponding to the subcritical part of our model [@Houchmandzadeh2003; @Campos2013]. Thus the power law distribution of patch sizes should be present from $\rho=0$ to near after the critical point $\rho_c$. As an alternative model we fitted an exponential distribution ($f(x)=e^{-\lambda x}$). As is usual in percolation studies we excluded the spanning patch from the estimation [@Stauffer1994]. Before the critical point we may not have a spanning species and thus we fitted the patch distribution of the species that has the largest patch.   

We measured the patch size distribution from simulations in a range of $\rho$ from neutral to niche communities, using a smaller set than the ones we used to estimate the critical point: $\rho$={0.0000, 0.0001,0.0002, 0.0003, 0.0005, 0.0010, 0.01}, the other parameters were from the first row of table 1 and a *Side* of 512 sites.  We performed 30 simulations that run near the steady-state time, and then collected the patch sizes of all species. In some simulations, the spanning cluster occupies a considerable proportion of the landscape, and in consequence very few patches remain to estimate a distribution. We only fitted a model when there are at least 20 patches and five different patch sizes. 

We fitted the mentioned discrete distributions using maximum likelihood methods [@Clauset2009], and then calculated the Akaike information criteria corrected for small samples ($AIC_c$) to select the best model [@Burnham2002; @Burnham2011]. All analyses were performed using the R statistical language [@RCoreTeam2015]. The fitting was made using code provided by Cosma R. Shalizi for the power law with exponential cutoff and the package poweRlaw for the other distributions [@Gillespie2015]. The complete source code for statistical analysis and the outputs of the model is available at GitHub <https://github.com/lsaravia/CriticalTransition> and figshare <http://dx.doi.org/10.6084/m9.figshare.2007537>.

## Application of early warnings to BCI forest data

The Barro Colorado Island forest plot is a 50 hectare rectangle (1000 m x 500 m) of tropical forest located in Panama and managed by the Smithsonian Tropical Research Institute [@Condit1998]. In this plot, all individuals $\geq$ 1 cm diameter at breast height (dbh) of free standing woody tree species have been measured and identified. Since the first census at 1982-1983, there was a second census in 1985, and then every five years; to date there are seven publicly available censuses. We estimate the patch distributions of each species for each census to apply the same set of early warning used for the model to check if there is any evidence of a critical transition. To estimate the patch distribution we first discretized the positions of the trees to fit them in a lattice. After that, we estimated largest patch statistics and fit the patch size distributions models for each year. To check for a tendency in the fitted parameters we performed a median regression.  

To estimate the patch distribution we need to choose a length scale to make the discretization. If we intend to fit all the individuals of all species on a different site the scale should be around 0.10 m for this plot, as the plot is 1000m x 500 m, resulting in a lattice of 10000x5000 sites with a great proportion of empty places. This will lead to a majority of isolated sites with almost no patches. If we use a bigger scale e.g. of 0.5 m, more than one individual of possibly different species may occupy some of the sites; in these cases, we have to decide which one will occupy the site. We establish that the one with greater dbh, no matter the species, will be the one that occupies the site, thus favoring more mature individuals.

In this process, we have to find the scale that gives us the maximum occupation of the lattice without losing the species structure of the community. Our criteria to stop enlarging the scale is that the species abundance distribution (SAD) of the discretized lattice should not be statistically different from the original SAD. To test this we use the Anderson-Darling statistic with a randomization procedure using the R package kSamples [@Scholz2015]; this statistic has proven powerful to detect different kinds of communities using SAD [@Saravia2015a]. With this procedure we obtained a scale of 1 m, and thus used a lattice of 1000x500 sites. 


# Results
 
We observed a typical pattern of a second order continuous phase transition (Figure 1) which means that at the critical point $\rho_c$ one species percolates through the lattice: a mono-specific patch spreads from side to side, which is called the spanning patch or spanning cluster. As expected from percolation theory [@Stauffer1994; @Sornette2013] the probability of a spanning cluster ($SC_p$) is greater than 0 for $\rho < \rho_c$ and small lattice sizes, for bigger lattice sizes $SC_p$ is 0 for $\rho < \rho_c$ and jumps quickly to 1 for $\rho > \rho_c$; this clearly defines the two phases or states of the system. These two phases can be detected by analyzing the largest patch relative to the total area $S_{max}$ before the critical point $\rho < \rho_c$ is in the range 0.002-0.15, and after the critical point $\rho > \rho_c$ is greater than 0.92. The largest patch relative to the total species' area $RS_{max}$ has the same behavior, with a range of 0.009-0.23 before, and greater than 0.96 after, the critical point (Appendix Figure S1 and Table S2). 

![Probability of Spanning cluster for a spatial neutral/niche model as a function of the intensity of competition $\rho$. When the competition intensity $\rho$ is near zero the community is at the neutral phase, the vertical line is the critical point and after it the community is in the niche phase. The columns represent two different metacommunity types: Logseries, a metacommunity with logseries species abundance distribution (SAD); Uniform, a metacommunity with a uniform SAD. The columns represent the side of the simulation lattice, the total size is $side^2$. The critical point was determined as the point where the spanning probability is 0.5, the other parameters used were $m$=0.0001, dispersal distance = 26.66](figs/SpanPvsRepl_T20000_320_side_meta_m0.0001.png)

The critical point $\rho_c^\infty$ is the value of the intensity of competition where the phase transition occurs at infinite lattices, obtained from the finite-size scaling analysis. The actual values for finite-size lattices may vary, but we observed that in general, the transition happened at very low $\rho$ values (Appendix Table 3). That means that low levels of competition are needed for a phase change, and this produces a sharply decrease in Shannon diversity. This is observed for both logseries and uniform metacommunities. The values for $\rho_c^\infty$ are very similar for logseries and uniform metacommunities.  

We analyzed how the critical point changes varying model parameters, and thus the validity of our findings is restricted to these ranges (Table 1). Most of the $\rho_c^\infty$ values fall in the range 0.0002-0.0003 (Appendix Table S3). Taking into account the standard error (Appendix Table S3), we conclude that there is not much variation of $\rho_c^\infty$ with regard to dispersal distance, number of species in the metacommunity, or the type of the metacommunity. The migration parameter $m$, instead, produced a variation in $\rho_c^\infty$ from around 0.0003 to 0.006. When $m$ is bigger there is more influence of the metacommunity on the local community. This is because the migration process adds individuals in the local community with the same species proportion than the metacommunity, favoring the less competitive species in both types of metacommunities simulated. Additionally, the individuals that migrate from the metacommunity have random positions and thus mix into the local community and break the species patches. The combined effect is to make the $\rho_c^\infty$ higher. The effect becomes important when $m=0.01$, which results in the biggest $\rho_c^\infty$ (approximately 0.006, an order of magnitude greater than all the other cases) (Appendix Table S3).

When the competitive intensity surpasses the critical point ($\rho_c$), the space left by the spanning species decreases quickly, so the Shannon diversity ($H$) collapses, but some individuals can escape the competitive displacement and thus richness ($S$) shows a more gentle fall (Figure 2). The same kind of patterns of $H$ and $S$ are observed with all the range of parameters of table 1; the only difference is the value of $\rho_c$ and the absolute values of $H$ and $S$. After the critical point a spanning patch appears (Figure 3) that occupies a great portion of the landscape. The number of species is almost the same, and $H$ drops quickly.  The effect of the competition-colonization trade-off can be observed in the logseries metacommunities: before the critical point there is a small increase in $H$ and also in $S$. This is because in the long term, the average SAD from a neutral community will tend to match the metacommunity SAD, for $m>0$ [@Houchmandzadeh2003]. Thus a small degree of competition lowers the density of species with high colonization rate, which were the most abundant, and raises $H$ before the critical point. The effect of the trade-off can also be observed in $S$, by the same mechanism there is a small increase in $S$ before the $\rho_c$ (Figure 2). Logseries communities also have fewer species than uniform communities because in the neutral phase poor colonizers have small populations and extinguish due to stochasticity. Comparing logseries with uniform communities at the same $\rho_c$, they always have fewer species.

![Shannon diversity index and species richness for a spatial neutral/niche model  as a function of the intensity of competition $\rho$. When the competition intensity $\rho$ is near zero the community is at the neutral phase, the vertical line is the critical point and after it the community is in the niche phase. Columns represent metacommunity types: Logseries is a metacommunity with logseries species abundance distribution (SAD), and the Uniform metacommunity have a uniform SAD, both with 320 species. Rows represent different Shannon Diversity and richness. Points are independent simulations of the model. The leftmost value of $\rho = 0$ has been shifted to allow its representation in logarithmic axes. Other parameters used were side of the simulation lattice 256 sites, $m$=0.0001, dispersal distance = 26.66.](figs/HSvsRepl_320_side256_meta_m0.0001.png)

![Spatial pattern for species before and after the critical points. The intensity of competition $\rho$ determines if the community is in a neutral or niche phase, for $\rho=0$ &  $\rho=0.0001$ the communities are neutral and for greater $\rho$ they surpassed the critical point and a spanning patch appears. The letter S in the labels represent the number of species, and the colors specified in the legend are the different species. The parameters used here were: side of the simulation lattice 256 sites, migration $m$=0.0001, dispersal distance = 26.66, and a uniform metacommunity with 64 species.](figs/SpatAllSp_Repl_T20000_64_256_Unif.png)

The differences between logseries and uniform communities also appear in the RADs (Appendix figure 2). Before the critical point, logseries communities have a convex shape reflecting that abundances of species with ranks from 10-30 have a slightly higher frequency than uniform communities. Species with ranks more than 40, which are rare species, have in contrast a more uniform frequency than do logseries communities. After the critical point the curvature is inverted (becomes concave) for both kind of communities. The change observed in RADs is more gradual than the observed in $H$ or in the $S_{max}$ and $RS_{max}$.

The largest patch fluctuations $\Delta S_{max}$ showed a much greater variance near the critical point than before or after (Figure 4A), and the same pattern is observed for $\Delta RS_{max}$ (Appendix figure S6). The skewness of $\Delta S_{max}$ have a positive value before the critical transition and a negative value after it, but it can have both positive or negative values when the critical transition is happening (Figure 4B). This means that these indicators should be combined to obtain an evaluation of the closeness to the critical point. If we observe a low value of $S_{max}$ or $RS_{max}$ then we know that the system is before the critical point, but if $\Delta S_{max}$ shows an increase and skewness becomes negative we can conclude that the system is about to suffer a critical transition. 

The fits of patch size distributions showed that the most frequent best model ---with lower $AIC_c$---was the power law with exponential cutoff (54%). The pure power law was found best in 21% of the cases and the exponential model was never the best (Appendix Table S4). The rest of the cases (25%) correspond to simulations with $\rho$ greater than $\rho_c$, in which one big spanning patch exists and there are few other patches of the same species, so a distribution model can not be fitted following the criteria stated in the Methods. 

Patch size distributions have been used to detect the closeness of the critical point when the spatial patterns are non-periodic or irregular as here [@Kefi2014]. Two kinds of patterns have been suggested as early warnings of a critical transition: a switch from a power law to a power law with exponential cutoff [@Kefi2011;@Kefi2007b]; and an increase of the $\lambda$ parameter---assuming that the power law with exponential cutoff is a plausible model for all the cases [@Pueyo2011]. We did not find evidence of a switch between power law and power law with exponential cutoff when the system approaches the critical point, as the power law with cutoff always had a greater percentage, except when $\rho$ was far from the critical point and only a few simulations could be fitted (Appendix figure S3). The exponent ($\alpha$) of both models showed a decreasing tendency when the critical point is approached, but there was a substantial amount of variability which makes the use of $\alpha$ dangerous as an early warning (Figure S4). The exponential decay rate parameter ($\lambda$) also exhibited a tendency to decrease when the critical point is approached (Figure S5), and there was a high degree of scattering. Thus these two indicators should be used with care and in combination with the previous ones.  

![Early warnings indicators for the critical transition between neutral and niche communities. A) The variance of temporal fluctuations of the largest patch relative to the total area $\Delta S_{max}$. B) Skewness of the temporal fluctuations of the largest patch relative to the total area  $\Delta S_{max}$. We simulated communities in the same time span than the simulations to determine the critical point---typically around 20000 time steps---we take the last 5000 and measure the patch sizes each 100 time steps. The communities that did not have a spanning patch were classified as "Before" the critical point, with a range of $\rho: 0 - 0.0004$. The communities that present a spanning patch in all the times are measured as "After" the critical point, with $\rho: 0.0004 - 1$. The communities where the spanning patch appears and disappears were classified as "Near" the critical point, with  $\rho: 0.0002 - 0.0004$. 
We made 10 simulations for each $\rho$ and two metacommunity types: "Logseries" species abundance distribution (SAD) and "Uniform" SAD. Metacommunities have 320 species, the size of the grid was 256*256 sites, migration from metacommunity was 0.0001, dispersal distance=26.66.](figs/VarSkewDeltaTSmaxvsCP_T20000_320_256_meta.png)


The calculation of early warnings for the BCI data showed the following values for the mean $S_{max}$=0.00008, the mean $RS_{max}$=0.04, the variances $\Delta S_{max}$=1.3e-10 and $\Delta RS_{max}$=0.0014; all of these were low values that situate the BCI before the critical point. The skewness of $\Delta S_{max}$=0.52 was positive, and for $\Delta RS_{max}$=-0.36 was negative. In all the years the best model for the patch size distributions was the power law with exponential cutoff, and the exponent $\alpha$ and the decay rate $\lambda$ showed a decreasing pattern (Appendix figure S7 & S8).   

# Discussion

We described for the first time a spatial phase transition between neutral and niche ecological communities. The power laws of patch size distributions observed in this model are not only produced at the critical point but are present over the whole range of the control parameter $\rho$. This broad range of power law behavior is characteristic of non-equilibrium phase transitions [@Odor2004] and can also be produced by spatial heterogeneity [@Martin2015]. There are some ecological models that display this kind of behavior and it has been termed robust criticality, because of the permanence of the scaling laws [@Pascual2005a]. These models all included disturbances or stress, and with the increase in disturbance levels an increase in the exponential decay ($\lambda$) of patch sizes is observed. This increase can be the result of a switch from a power law to a power law with exponential cutoff model [@Kefi2011] or by an increment of $\lambda$ in the power law with exponential cutoff model [@Weerman2012]. 

The most important parameter influencing the value of the critical point is the migration from the metacommunity $m$. It was previously observed that immigration is crucial for maintaining diversity in spatial competition models [@Loreau1999] and neutral models [@Hubbell2001]. If there is no immigration  ($m=0)$ eventually only one species will dominate the local community [@Hubbell2001], this is produced by the finite size of the local community [@Sole2004], and we observed it for low values of $m$ and smaller sizes of the lattice.  Thus is clear that a higher $m$ will produce a community more resistant to competitive replacement. Besides that, in our model, $m$ represent the probability of a long-distance dispersal event that happens at random in the simulation area. Thus, high values of $m$ will break the local patch structure, particularly could disrupt the spanning patch, and produce an increase in the critical point.    

In our simulations, the competition intensity $\rho$ can play the same role as stress: a very small degree of competition produce a critical transition from a neutral phase to a niche phase, and the most competitive species invades a great portion of the landscape. The sequence of an increasing $\lambda$ when the critical point is approached is not observed in our model but a decrease of it when the system goes towards the critical point, and then an increase. This coincides with theoretical predictions from percolation theory [@Stauffer1994], at the critical point the exponential decay in the patch distribution vanishes and the patch distribution becomes closer to a pure power law. 

We observed a decrease of $\lambda$ but also a decrease of the power law exponent $\alpha$ when the system is approaching the critical point $\rho_c$, and both reach a minimum after it. Thus the pattern that can be used to  detect if we are approaching the critical point and the biodiversity collapse is the decrease in $\lambda$ and $\alpha$, but there is a wide variability in both parameters so it is possible that we do not observe this decrease and still the system is heading to the critical point.

A commonly used pattern to characterize ecological communities is the species abundance distribution, which we used in the form of rank abundance distributions (RAD). It was demonstrated that neutral and niche mechanisms could produce the same RAD [@Volkov2005;@Chisholm2010], so it might not be used to determine the proximity to the critical point.  We found that there is a change in the RAD when the critical point is approached but these changes are small and will probably go undetected [@Saravia2015a]. The shape of the RAD is highly dependent on the metacommunity, which is difficult to estimate as a baseline, thus there is no RAD characteristic of a community near the critical point. The species richness and Shannon diversity of the community are both resumed versions of the species abundance distribution. Richness and Shannon diversity may have a small increment or start to decrease when the community goes through the critical transition; both depend on the metacommunity and on the existence of trade-off. Thus these two indices can be misleading indicators of the proximity of a critical transition.

The existence of the two phases or states of the system can be characterized by the size of the largest patch in proportion to the size of the area of the system $S_{max}$, and with the size of the largest patch in proportion to the total species' area $RS_{max}$. If we are analyzing regions with non-habitable areas that can not be easily detected and we included them in the total area, the $ S_max could be relatively low and give a false impression that the system is in a neutral phase. Thus RS_max is a more robust indicator of the phases

The analysis of the fluctuations in the largest patch is a relatively new early warning indicator that was proposed for a patch model representing desertification [@Kefi2007b], and it has not yet been applied to the existing observational data on desertification processes. We present here the first analysis of fluctuations of $S_{max}$ and $RS_{max}$ for a multi-species model, these indicators combine both spatial and temporal information and were the most robust early warning indicator from the set we analyzed. Moreover, these indicators were easier to estimate than parameters of patch size models that require fitting methods and model selection procedures to be identified. As they are based only on geometrical properties of patches (percolation) that happen in a wide array of models [@Abades2014; @Oborny2007; @Bonachela2012; @Gastner2009; @Sole2004], they have the potential to be used as generic indicators that can be applied to most spatial ecological systems. We think that the analysis of the largest patch either with only one snapshot of the spatial distribution: analyzing the proportions ($S_{max}$ / $RS_{max}$) or the fluctuations are a promising avenue to obtain warnings of sudden changes in ecosystems. 

We calculated all the early warnings for the species patch distribution of the Barro Colorado Island at Panama (BCI). First using the relative size of the largest patch, $S_{max}$ or $RS_{max}$, we identified that the BCI is most probably in a neutral phase, as suggested by other studies [@Seri2012;@Jabot2011]. The variance of the fluctuations is also very small which indicates us that BCI is not near a critical transition of this kind. The Skewness of $RS_{max}$ and the decrease of the power law exponent $\alpha$ and the decay parameter $\lambda$ of the patch size distribution are also compatible with a system far from the transition thus we concluded that the forest seems not to be close ---until now---to a critical point. 

Percolation transitions are second order or continuous critical transitions. This means that unless the system becomes degraded and changes its internal dynamics, these transitions are reversible. Much of the ecological literature was dedicated to studying first order or discontinuous transitions that produce hysteresis ---also called regime shifts---and rely on the understanding of deterministic equations [@Sole2006]. These kinds of transitions are practically irreversible but in real ecosystems the presence of noise and spatial heterogeneities can convert irreversible transitions into second order transitions [@Martin2015], this enhances the importance of second order phase transitions like the ones showed here.

Using a spatially implicit model Fisher & Metha  [-@Fisher2014] described a phase transition between neutral and niche communities. They used a stochastic Lokta-Volterra model for niche communities where neutral dynamics was added as Gaussian noise. Their mechanism is similar to ours but not restricted to hierarchical competition. This suggests that our results can be extended to a broad kind of competitive interactions that are present in real ecosystems [@Soliveres2015]. A generalized stochastic interaction model can be defined in which species could have different colonization, mortality and interactions [@Sole2002a], in this model transitive or intransitive competition, and even predation could be included. The average of interaction coefficients is analogous to the intensity of competition $\rho$ used here, we expect that if vary the average interaction from low to high we will observe the same kind of phase transition described here. 

The Fisher & Metha model predicts that under stress a community will suffer a biodiversity collapse produced by a shift towards neutrality. This means that disturbed less diverse communities should have neutral dynamics. This prediction is contrary to most of the models and experimental data that suggest that niche dynamics dominate low-diversity communities while neutral dynamics will be more common in high diversity communities [@Chisholm2011]. Our results are in agreement with with this last prediction: when the system shift from the neutral phase to the niche phase the reduction in richness and diversity is produced.

The results our model agree with similar works in spatially implicit models and implies that most ecosystems will exhibit patterns of diversity that are either strongly niche-structured or indistinguishable from neutral [@Chisholm2011; @Fisher2014].  Several field studies have demonstrated that weak interactions are a general phenomenon for species-rich communities [@Martorell2014; @Volkov2009] which is also observed for natural food webs [@Wootton2005b], so it is possible that these communities live near the critical point between neutrality and niche. This suggests the existence of a mechanism similar to critical self-organization as hypothesized by Solé et al. [-@Sole2002a] called self-organized instability. In this general mechanism, the immigration of new species increases diversity and connectivity. We argue that it also increase average interaction strength---because if there is an increase in connectivity there has to be some interaction. This will happen until the critical point is reached and then diversity diminishes. Thus, only communities with weak interactions can maintain high diversity in the long term. This agrees with some new theoretical developments which state that the number of interactions (connectivity) and average interaction strength determines the conditions for coexistence [@Grilli2017]. The mechanisms included in this model are generic, the only differences between species are their competitive ability and their frequency in the metacommunity. The habitat is homogeneous so niche partition mechanisms are not included but the final effect could be the same at the end: the lowering of the intensity of interactions. 

Habitat fragmentation produces more isolated communities [@Haddad2015], where less space is available to species; this is equivalent to a community composed of fewer sites. Then it is probable that fragmentation shifts the critical point to lower values making the communities more sensitive to environmental changes. At the same time, these communities would have a stronger niche effect and a high probability of biodiversity collapse. This effect was observed in tropical communities affected by fragmentation: local extinctions are mediate by niche-based competitive interactions [@Bregman2015].  As we have previously mentioned, the distribution of habitable and non-habitable sites produced by fragmentation could result in percolation and critical phenomena that is different to the described here [@Saravia2016a]. The interplay between these two critical transitions can be more complex than was previously thought [@Oborny2007]. Thus the combination of these two critical phenomena should be thoroughly studied, also the extension to different kinds of interactions including food webs, mutualistic communities and intransitive competition [@Soliveres2015] is a fundamental next step.

The novelty of this critical transition is that it occurs before transitions produced by habitat loss, deforestation, land use changes, increased grazing, or fragmentation; and it only needs a change in the environmental conditions that alters the strength of the interaction between species. This also could be produced if species that previously did not interact have the possibility to compete, in the same line an invading species could have such effect and trigger a phase transition in a formerly neutral community. A significant portion of biosphere's ecosystems are under the pressures generated by human-induced activities, but human activities also produce global-scale forcings ---like climate change---that can reach relatively pristine ecosystems although they are not under a direct influence of human activities [@Barnosky2012]. This kind of changes can be represented by the phase transition described here before the ecosystem is under a direct degradation, and the detection of this kind of transition could be used as a signal to detect a global state shift in the biosphere.

# Acknowledgments

We are grateful to the National University of General Sarmiento for financial support, and to Graeme Ruxton for their English revision. This work was partially supported by a grant from CONICET (PIO 144-20140100035-CO). We thank the two anonymous reviewers and to the subject editor for their valuable comments. Also, we like to thank Jordi Bascompte, Juan Bonachela and Karina Laneri for their comments and discussions on earlier versions of the manuscript.The BCI forest dynamics research project was made possible by National Science Foundation grants to Stephen P. Hubbell: DEB-0640386, DEB-0425651, DEB-0346488, DEB-0129874, DEB-00753102, DEB-9909347, DEB-9615226, DEB- 9615226, DEB-9405933, DEB-9221033, DEB-9100058, DEB- 8906869, DEB-8605042, DEB-8206992, DEB-7922197, support from the Center for Tropical Forest Science, the Smithsonian Tropical Research Institute, the John D. and Catherine T. MacArthur Foundation, the Mellon Foundation, the Celera Foundation, and numerous private individuals, and through the hard work of over 100 people from 10 countries over the past two decades. The plot project is part of the Center for Tropical Forest Science, a global network of large-scale demographic tree plots.


# References
